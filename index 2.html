<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Tua Scheda Personalizzata</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Oswald:wght@500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #ff4757;
            --primary-light: #ff6b81;
            --primary-dark: #ff0000;
            --secondary: #2f3542;
            --secondary-light: #57606f;
            --accent: #ff6b81;
            --light: #f1f2f6;
            --dark: #1e272e;
            --success: #2ed573;
            --success-light: #7bed9f;
            --warning: #ffa502;
            --warning-light: #ffbe76;
            --info: #1e90ff;
            --info-light: #70a1ff;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f8f9fa;
            background-image: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.9) 100%), url('https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-attachment: fixed;
            color: var(--dark);
            line-height: 1.6;
            padding: 0;
            margin: 0;
            -webkit-text-size-adjust: 100%;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
            width: 100%;
        }
        
        header {
            background: linear-gradient(135deg, var(--secondary), var(--dark));
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        h1, h2, h3, h4 {
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            margin-top: 0;
        }
        
        h1 {
            font-size: clamp(1.8rem, 5vw, 2.8rem);
            margin: 0;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            padding: 0 10px;
        }
        
        h2 {
            color: var(--secondary);
            font-size: clamp(1.4rem, 4vw, 1.8rem);
            margin-top: 25px;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 8px;
            display: inline-block;
        }
        
        .logo {
            font-size: clamp(1.8rem, 6vw, 3rem);
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            padding: 0 10px;
        }
        
        .form-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 12px;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: clamp(0.9rem, 3vw, 1rem);
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px 12px 35px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: clamp(0.9rem, 3vw, 1rem);
            transition: all 0.3s;
            background-color: #fff;
            -webkit-appearance: none;
        }
        
        .input-icon {
            position: absolute;
            left: 12px;
            top: 38px;
            color: var(--secondary-light);
            font-size: clamp(0.9rem, 3vw, 1rem);
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: clamp(0.9rem, 3vw, 1rem);
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 8px 8px 0 0;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 100%;
            justify-content: center;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .button-group button {
            width: auto;
            flex: 1 1 auto;
            min-width: 150px;
        }
        
        #scheda {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-top: 25px;
            position: relative;
            border: 1px solid rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            min-width: 600px;
        }
        
        th, td {
            padding: 10px 12px;
            text-align: left;
            font-size: clamp(0.8rem, 3vw, 0.9rem);
        }
        
        th {
            background-color: var(--secondary);
            color: white;
            position: sticky;
            top: 0;
        }
        
        td {
            border-bottom: 1px solid #eee;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .warmup-stretching {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 20px 0;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        ul {
            padding-left: 20px;
            list-style-type: none;
            margin: 15px 0;
        }
        
        li {
            margin-bottom: 8px;
            position: relative;
            padding-left: 25px;
            font-size: clamp(0.9rem, 3vw, 1rem);
        }
        
        .social {
            background: var(--secondary);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .social-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-around;
        }
        
        .contact-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            flex: 1 1 300px;
            max-width: 100%;
            transition: all 0.3s;
            border-left: 4px solid var(--primary);
        }
        
        .contact-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.2);
        }
        
        .contact-card h4 {
            color: var(--primary-light);
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }
        
        .contact-links {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .contact-links a {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            padding: 8px 12px;
            border-radius: 6px;
            background: rgba(0,0,0,0.2);
        }
        
        .contact-links a:hover {
            background: var(--primary);
            transform: translateX(5px);
        }
        
        .success {
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: clamp(1rem, 4vw, 1.2rem);
        }
        
        .warning {
            color: var(--warning);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: clamp(0.9rem, 3vw, 1rem);
        }
        
        .info {
            color: var(--info);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: clamp(0.9rem, 3vw, 1rem);
        }
        
        .highlight-box {
            background: linear-gradient(135deg, #fff5f5, #ffecec);
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 6px 6px 0;
            position: relative;
            font-size: clamp(0.9rem, 3vw, 1rem);
        }
        
        .week-title {
            background: linear-gradient(135deg, var(--secondary), var(--dark));
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 15px 0 8px;
            font-size: clamp(1rem, 4vw, 1.2rem);
        }
        
        .day-title {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 6px 12px;
            border-radius: 5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 12px 0 6px;
            font-size: clamp(0.9rem, 3vw, 1.1rem);
        }
        
        .exercise-icon {
            color: var(--primary);
            margin-right: 6px;
            font-size: 0.9em;
        }

        /* Sezione BMI */
        .bmi-section {
            background: linear-gradient(135deg, #f5f7fa, #e4e8f0);
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .bmi-title {
            color: var(--primary);
            font-size: clamp(1.3rem, 4vw, 1.6rem);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .bmi-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0;
            color: var(--secondary);
        }

        .bmi-category {
            font-size: 1.2rem;
            font-weight: 600;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 15px;
        }

        .underweight {
            background-color: #70a1ff;
            color: white;
        }

        .normal {
            background-color: #2ed573;
            color: white;
        }

        .overweight {
            background-color: #ffbe76;
            color: white;
        }

        .obese {
            background-color: #ff4757;
            color: white;
        }

        .bmi-info {
            text-align: left;
            margin-top: 15px;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Tooltip per tipi di fisico */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: var(--primary);
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: var(--secondary);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Sezione Donazioni */
        .donation-section {
            background: linear-gradient(135deg, #f5f7fa, #e4e8f0);
            border-radius: 10px;
            padding: 25px;
            margin: 40px 0 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .donation-title {
            color: var(--primary);
            font-size: clamp(1.3rem, 4vw, 1.6rem);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .donation-text {
            margin-bottom: 20px;
            font-size: clamp(0.95rem, 3vw, 1.05rem);
            line-height: 1.6;
        }

        .donation-methods {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .donation-method {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            flex: 1 1 300px;
            max-width: 100%;
            text-align: left;
            border-left: 4px solid var(--primary);
        }

        .donation-method h4 {
            color: var(--secondary);
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .thank-you-message {
            display: none;
            background: var(--success-light);
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            border-left: 4px solid var(--success);
        }

        /* Sezione Footer */
        .footer-section {
            background-color: var(--secondary);
            color: white;
            padding: 30px;
            margin-top: 40px;
            border-radius: 10px;
            font-size: 0.9rem;
        }

        .footer-section a {
            color: var(--accent);
            text-decoration: none;
            transition: all 0.3s;
        }

        .footer-section a:hover {
            text-decoration: underline;
            color: var(--primary-light);
        }

        .footer-columns {
            display: flex;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 20px;
        }

        .footer-column {
            flex: 1;
            min-width: 250px;
        }

        .footer-column h4 {
            color: var(--primary);
            margin-top: 0;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 5px;
            display: inline-block;
            font-size: 1.1rem;
        }

        .footer-column p {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .footer-column strong {
            color: var(--primary-light);
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: 20px;
            font-size: 0.85rem;
            color: rgba(255,255,255,0.7);
        }
        
        /* Stretching avanzato */
        .stretching-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stretching-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary);
        }
        
        .stretching-card h4 {
            color: var(--secondary);
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stretching-card ul {
            margin-top: 10px;
        }
        
        .stretching-card li {
            margin-bottom: 10px;
            padding-left: 30px;
        }
        
        .stretching-card li:before {
            content: "•";
            color: var(--primary);
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }
        
        .execution-tips {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 12px;
            margin-top: 10px;
            font-size: 0.9rem;
            border-left: 3px solid var(--info);
        }
        
        /* Animazioni e effetti visivi */
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .glow {
            text-shadow: 0 0 10px rgba(255, 71, 87, 0.7);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        /* Mobile specific styles */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 15px 0;
                margin-bottom: 15px;
            }
            
            .form-container, #scheda, .warmup-stretching, .social, .donation-section, .footer-section {
                padding: 15px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .button-group {
                flex-direction: column;
                gap: 8px;
            }
            
            .button-group button {
                width: 100%;
                min-width: unset;
            }
            
            table {
                font-size: 0.8rem;
            }
            
            th, td {
                padding: 8px 10px;
            }

            .footer-columns {
                flex-direction: column;
                gap: 20px;
            }

            .footer-section {
                padding: 20px 15px;
            }
            
            .social-content {
                flex-direction: column;
            }
            
            .contact-card {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.6rem;
            }
            
            h2 {
                font-size: 1.3rem;
            }
            
            .logo {
                font-size: 1.6rem;
                gap: 5px;
            }
            
            input, select {
                padding: 10px 12px 10px 30px;
            }
            
            .input-icon {
                left: 10px;
                top: 33px;
            }
            
            button {
                padding: 10px 15px;
            }
        }
        
        /* Print styles */
        @media print {
            body {
                background: white;
                font-size: 12pt;
            }
            
            .container {
                padding: 0;
                max-width: 100%;
            }
            
            header, .form-container, .button-group, .social, .donation-section, .footer-section, .bmi-section {
                display: none;
            }
            
            #scheda, .warmup-stretching {
                box-shadow: none;
                border: none;
                padding: 0;
                margin: 0 0 20px 0;
                page-break-inside: avoid;
            }
            
            table {
                page-break-inside: auto;
            }
            
            tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo pulse">A.S.D CENTROFITNESS</div>
            <h1 class="glow">La Tua Scheda Personalizzata</h1>
            <p>Crea il tuo piano di allenamento su misura per le prossime 6 settimane</p>
        </div>
    </header>

    <div class="container">
        <div class="form-container">
            <h2><i class="fas fa-user"></i> Informazioni Personali</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="nome"><i class="fas fa-signature"></i> Nome</label>
                    <i class="fas fa-user input-icon"></i>
                    <input type="text" id="nome" placeholder="Es. Mario" required>
                </div>
                
                <div class="form-group">
                    <label for="cognome"><i class="fas fa-signature"></i> Cognome</label>
                    <i class="fas fa-user input-icon"></i>
                    <input type="text" id="cognome" placeholder="Es. Rossi" required>
                </div>
                
                <div class="form-group">
                    <label for="eta"><i class="fas fa-birthday-cake"></i> Età</label>
                    <i class="fas fa-calendar-alt input-icon"></i>
                    <input type="number" id="eta" min="10" max="100" value="30">
                </div>
                
                <div class="form-group">
                    <label for="genere"><i class="fas fa-venus-mars"></i> Genere</label>
                    <i class="fas fa-user-tag input-icon"></i>
                    <select id="genere">
                        <option value="uomo">Uomo</option>
                        <option value="donna">Donna</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="peso"><i class="fas fa-weight"></i> Peso (kg)</label>
                    <i class="fas fa-weight-hanging input-icon"></i>
                    <input type="number" id="peso" min="30" max="200">
                </div>
                
                <div class="form-group">
                    <label for="altezza"><i class="fas fa-ruler-vertical"></i> Altezza (cm)</label>
                    <i class="fas fa-arrows-alt-v input-icon"></i>
                    <input type="number" id="altezza" min="120" max="250">
                </div>
                
                <div class="form-group">
                    <label for="fisico"><i class="fas fa-tshirt"></i> Tipo di fisico 
                        <span class="tooltip">
                            <i class="fas fa-info-circle"></i>
                            <span class="tooltiptext">
                                <strong>Ectomorfo:</strong> Corporatura snella, difficoltà a mettere massa<br>
                                <strong>Mesomorfo:</strong> Corporatura atletica, muscoli ben definiti<br>
                                <strong>Endomorfo:</strong> Corporatura robusta, tendenza ad accumulare grasso
                            </span>
                        </span>
                    </label>
                    <i class="fas fa-user-shield input-icon"></i>
                    <select id="fisico">
                        <option value="ectomorfo">Ectomorfo</option>
                        <option value="mesomorfo">Mesomorfo</option>
                        <option value="endomorfo">Endomorfo</option>
                    </select>
                </div>
            </div>
            
            <h2><i class="fas fa-dumbbell"></i> Preferenze Allenamento</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="tipologia"><i class="fas fa-clipboard-list"></i> Tipologia di scheda</label>
                    <i class="fas fa-tasks input-icon"></i>
                    <select id="tipologia">
                        <option value="classica">Classica</option>
                        <option value="totalbody">Total Body</option>
                        <option value="over60">Over 60</option>
                        <option value="gambe">Solo Gambe</option>
                        <option value="cardio">Solo Cardio</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="giorni"><i class="fas fa-calendar-day"></i> Giorni di allenamento</label>
                    <i class="fas fa-calendar-week input-icon"></i>
                    <select id="giorni">
                        <option value="3">3 giorni</option>
                        <option value="4">4 giorni</option>
                        <option value="5">5 giorni</option>
                        <option value="6" selected>6 giorni</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="obiettivo"><i class="fas fa-bullseye"></i> Obiettivo</label>
                    <i class="fas fa-flag-checkered input-icon"></i>
                    <select id="obiettivo">
                        <option value="massa">Aumento Massa</option>
                        <option value="definizione">Definizione</option>
                        <option value="forza">Forza</option>
                        <option value="dimagrimento">Dimagrimento</option>
                        <option value="cardio">Cardio</option>
                    </select>
                </div>
            </div>
            
            <div class="highlight-box">
                <p><i class="fas fa-info-circle"></i> <strong>Nota:</strong> Compila tutti i campi per generare una scheda personalizzata. La scheda sarà strutturata su 6 settimane di allenamento.</p>
            </div>
            
            <div class="button-group">
                <button onclick="generaScheda()" class="pulse"><i class="fas fa-magic"></i> Genera Scheda</button>
                <button onclick="scaricaPDF()"><i class="fas fa-file-pdf"></i> Scarica in PDF</button>
            </div>
        </div>

        <div id="scheda"></div>

        <div class="warmup-stretching">
            <h2><i class="fas fa-fire"></i> Riscaldamento Consigliato</h2>
            <p class="info"><i class="fas fa-clock"></i> Esegui 5-10 minuti di riscaldamento prima di ogni allenamento</p>
            
            <div class="stretching-grid">
                <div class="stretching-card">
                    <h4><i class="fas fa-heartbeat"></i> Cardio leggero</h4>
                    <ul>
                        <li><strong>Camminata veloce o corsa leggera:</strong> 5-10 minuti a intensità moderata per aumentare gradualmente la frequenza cardiaca</li>
                        <li><strong>Cyclette o ellittica:</strong> 5-10 minuti con resistenza media, mantenendo un ritmo costante</li>
                        <li><strong>Salto con la corda:</strong> 2-3 minuti iniziando lentamente e aumentando gradualmente la velocità</li>
                    </ul>
                    <div class="execution-tips">
                        <p><i class="fas fa-lightbulb"></i> <strong>Suggerimenti:</strong> Il cardio leggero dovrebbe aumentare gradualmente la temperatura corporea senza affaticarti. Dovresti essere in grado di parlare comodamente durante l'esecuzione.</p>
                    </div>
                </div>
                
                <div class="stretching-card">
                    <h4><i class="fas fa-running"></i> Attivazione articolare</h4>
                    <ul>
                        <li><strong>Rotazioni delle spalle:</strong> 30 secondi per direzione (avanti e indietro) per mobilizzare l'articolazione scapolo-omerale</li>
                        <li><strong>Circonduzioni delle braccia:</strong> 30 secondi alternando avanti e indietro con movimento ampio e controllato</li>
                        <li><strong>Rotazioni del bacino:</strong> 30 secondi in senso orario e antiorario per mobilizzare l'articolazione dell'anca</li>
                        <li><strong>Flessioni ed estensioni delle ginocchia:</strong> 20 ripetizioni lente e controllate per attivare i muscoli delle gambe</li>
                    </ul>
                    <div class="execution-tips">
                        <p><i class="fas fa-lightbulb"></i> <strong>Suggerimenti:</strong> Esegui tutti i movimenti con controllo, senza forzare le articolazioni. L'obiettivo è aumentare il range di movimento gradualmente.</p>
                    </div>
                </div>
                
                <div class="stretching-card">
                    <h4><i class="fas fa-dumbbell"></i> Attivazione muscolare</h4>
                    <ul>
                        <li><strong>Squat a corpo libero:</strong> 3 serie da 15 ripetizioni con movimento completo e controllo</li>
                        <li><strong>Affondi sul posto:</strong> 2 serie da 10 ripetizioni per gamba, mantenendo il busto eretto</li>
                        <li><strong>Push-up:</strong> 2 serie da 10-15 ripetizioni, modificando l'inclinazione se necessario</li>
                        <li><strong>Superman:</strong> 2 serie da 15 secondi per lato per attivare la muscolatura della schiena</li>
                    </ul>
                    <div class="execution-tips">
                        <p><i class="fas fa-lightbulb"></i> <strong>Suggerimenti:</strong> Esegui questi esercizi con un'intensità moderata (50-60% del massimo sforzo). Concentrati sulla qualità del movimento piuttosto che sulla quantità.</p>
                    </div>
                </div>
            </div>
            
            <div class="highlight-box">
                <p><i class="fas fa-heartbeat"></i> <strong>Benefici del riscaldamento:</strong> Aumenta la temperatura corporea, migliora la circolazione sanguigna, prepara muscoli e articolazioni all'allenamento, riduce il rischio di infortuni e migliora la performance.</p>
            </div>
        </div>

        <div class="social">
            <h2><i class="fas fa-address-book"></i> Contatti</h2>
            <p>Hai bisogno di un piano personalizzato o di assistenza? Contattaci!</p>
            
            <div class="social-content">
                <div class="contact-card">
                    <h4><i class="fas fa-user-tie"></i> Francesco</h4>
                    <div class="contact-links">
                        <a href="https://www.instagram.com/francesco_oretti" target="_blank">
                            <i class="fab fa-instagram"></i> Instagram
                        </a>
                        <a href="https://wa.me/393204152543" target="_blank">
                            <i class="fab fa-whatsapp"></i> WhatsApp: 3204152543
                        </a>
                        <a href="mailto:AsdCentroFitness00@gmail.com">
                            <i class="fas fa-envelope"></i> Email
                        </a>
                    </div>
                </div>
                
                <div class="contact-card">
                    <h4><i class="fas fa-user-tie"></i> Federico</h4>
                    <div class="contact-links">
                        <a href="https://www.instagram.com/federico_iacomelli" target="_blank">
                            <i class="fab fa-instagram"></i> Instagram
                        </a>
                        <a href="https://wa.me/393895175911" target="_blank">
                            <i class="fab fa-whatsapp"></i> WhatsApp: 3895175911
                        </a>
                        <a href="mailto:AsdCentroFitness00@gmail.com">
                            <i class="fas fa-envelope"></i> Email
                        </a>
                    </div>
                </div>
                
                <div class="contact-card">
                    <h4><i class="fas fa-info-circle"></i> Informazioni</h4>
                    <div class="contact-links">
                        <a href="#">
                            <i class="fas fa-map-marker-alt"></i> Via Roma, 287/A, Monteroni d'Arbia (SI)
                        </a>
                        <a href="tel:+393895175911">
                            <i class="fas fa-phone"></i> 389 517 5911
                        </a>
                        <a href="mailto:AsdCentroFitness00@gmail.com">
                            <i class="fas fa-at"></i> AsdCentroFitness00@gmail.com
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="donation-section">
            <div class="donation-title">
                <i class="fas fa-hand-holding-heart"></i> Supporta il Progetto
            </div>
            <div class="donation-text">
                Questo generatore di schede di allenamento è offerto gratuitamente. Se lo trovi utile e vuoi contribuire 
                al suo sviluppo e mantenimento, considera una donazione. Ogni contributo ci aiuta a migliorare il servizio!
            </div>
            
            <div class="donation-methods">
                <div class="donation-method">
                    <h4><i class="fab fa-paypal"></i> PayPal</h4>
                    <p>Per donazioni rapide via PayPal:</p>
                    <a href="https://www.paypal.com/pools/c/9eFyKvdZv3" target="_blank" style="text-decoration: none;">
                        <button style="background-color: #003087; margin-top: 10px; width: 100%;" class="pulse">
                            <i class="fab fa-paypal"></i> Donazione con PayPal
                        </button>
                    </a>
                    <p style="font-size: 0.8em; margin-top: 10px; color: #666;">
                        <i class="fas fa-lock"></i> Transazione sicura tramite PayPal
                    </p>
                </div>
            </div>
            
            <div id="thankYouMessage" class="thank-you-message">
                <i class="fas fa-heart"></i> <strong>Grazie per il tuo supporto!</strong> La tua donazione ci aiuterà a mantenere e migliorare questo servizio.
                <div id="countdown" style="font-size: 0.8em; margin-top: 5px;"></div>
            </div>
        </div>

        <div class="footer-section">
            <div class="footer-columns">
                <div class="footer-column">
                    <h4>Informazioni</h4>
                    <p>Generatore di schede di allenamento personalizzate per il fitness e il bodybuilding. Strumento professionale per atleti e appassionati.</p>
                    <p><strong>Sede:</strong> Via Roma, 287/A, 53014 Monteroni d'Arbia (SI)</p>
                    <p><strong>Tel:</strong> 389 517 5911</p>
                    <p><strong>Email:</strong> AsdCentroFitness00@gmail.com</p>
                </div>
                
                <div class="footer-column">
                    <h4>Privacy</h4>
                    <p>Questo sito non raccoglie dati personali senza il tuo consenso. Tutte le informazioni inserite vengono elaborate solo localmente nel tuo browser.</p>
                    <p><a href="https://eur-lex.europa.eu/legal-content/IT/TXT/HTML/?uri=CELEX:32016R0679" target="_blank" rel="noopener noreferrer"><i class="fas fa-shield-alt"></i> Leggi il Regolamento UE 2016/679 (GDPR)</a></p>
                </div>
                
                <div class="footer-column">
                    <h4>Dati Societari</h4>
                    <p><strong>A.S.D. CentroFitness</strong></p>
                    <p>P.IVA: 01417350525</p>
                    <p>Codice Fiscale: 92057520527</p>
                    <p><a href="#terms"><i class="fas fa-file-contract"></i> Termini e condizioni di utilizzo</a></p>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 A.S.D. CentroFitness - Tutti i diritti riservati</p>
                <p>Il contenuto di questo sito è protetto da copyright e non può essere riprodotto senza autorizzazione.</p>
            </div>
        </div>
    </div>

    <script>
        const esercizi = {
            petto: ["Panca piana con bilanciere", "Croci su panca inclinata con manubri", "Panca declinata con bilanciere", "Chest press", "Push up", "Croci ai cavi alti", "Croci ai cavi bassi", "Croci con manubri su panca piana", "Spinte con manubri su panca inclinata", "Spinte con manubri su panca piana"],
            schiena: ["Lat machine", "Rematore con bilanciere", "Pulley basso", "Trazioni alla sbarra", "Pullover", "Low row", "Lat machine presa inversa", "Lat machine Presa neutra", "Triangolo alla lat machine", "Pulley presa larga"],
            gambe: ["Squat", "Leg press", "Affondi", "Stacchi da terra", "Leg extension", "Adductor machine", "Abductor machine", "Stacchi rumeni", "Hiptrust", "Gluteos machine", "Calf seduto", "Calf in piedi", "Hack squat", "Leg curl", "Good morning"],
            spalle: ["Lento avanti", "Alzate laterali", "Alzate frontali", "Shoulder press", "Alzate a 90°", "Face pull", "Spinte Frontali su panca a 90", "Arnold Press", "Alzate oblique al cavo"],
            braccia: ["Curl con bilanciere", "Curl alternato con manubri", "French press", "Push down", "Hammer curl", "Bicipite machine", "Push down con corda", "Spider curl su panca a 30/45"],
            core: ["Crunch", "Plank", "Russian twist", "Sit-up", "Leg raise"]
        };

        const suggerimenti = {
            "Panca piana con bilanciere": "Controlla il movimento nella fase negativa. Mantieni i piedi ben piantati a terra e la schiena aderente alla panca. Non bloccare i gomiti nella fase di spinta.",
            "Croci su panca inclinata con manubri": "Concentrati sull'allungamento muscolare. Mantieni i gomiti leggermente flessi e controlla il movimento in tutte le fasi.",
            "Panca declinata con bilanciere": "Ottimo per la parte bassa del petto. Assicurati di avere un assistente per questo esercizio. Mantieni la schiena aderente alla panca.",
            "Chest press": "Evita di bloccare i gomiti in alto. Controlla la fase negativa e spingi con controllo. Mantieni le scapole addotte durante l'esecuzione.",
            "Push up": "Mantieni il corpo in linea retta dalla testa ai piedi. Se troppo difficile, esegui sulle ginocchia. Per aumentare l'intensità, alza i piedi su una superficie rialzata.",
            "Lat machine": "Tira con i gomiti, non con le mani. Mantieni il busto leggermente inclinato all'indietro. Non usare slancio per tirare la barra verso il basso.",
            "Rematore con bilanciere": "Schiena sempre dritta. Piega leggermente le ginocchia e mantieni il busto inclinato a 45°. Tira il bilanciere verso l'addome, non verso il petto.",
            "Pulley basso": "Evita lo slancio, concentrati sul movimento. Mantieni le spalle basse e lontano dalle orecchie. Tira la barra verso l'addome, mantenendo i gomiti vicini al corpo.",
            "Trazioni alla sbarra": "Mantieni il controllo in discesa. Inizia con presa larga e prova a toccare la sbarra con il petto. Se troppo difficile, usa una banda elastica di supporto.",
            "Pullover": "Respira profondamente durante l'allungamento. Mantieni i gomiti leggermente flessi. Esegui su panca piana con un manubrio o bilanciere.",
            "Squat": "Scendi almeno al parallelo. Mantieni il petto alto e il peso sui talloni. Non inarcare la schiena durante l'esecuzione.",
            "Leg press": "Non stendere mai completamente le gambe. Mantieni la schiena aderente allo schienale. Non bloccare le ginocchia nella fase di spinta.",
            "Affondi": "Tieni il busto eretto. Fai passi abbastanza lunghi da permettere alla gamba anteriore di formare un angolo di 90°. Non lasciare che il ginocchio anteriore superi la punta del piede.",
            "Stacchi da terra": "Usa una forma corretta per evitare infortuni. Mantieni la schiena neutra e il peso vicino al corpo durante il sollevamento. Spingi con le gambe, non tirare con la schiena.",
            "Leg extension": "Controlla il movimento e non usare troppo peso. Non bloccare le ginocchia in estensione. Esegui il movimento lentamente, soprattutto nella fase negativa.",
            "Lento avanti": "Esegui l'esercizio lentamente. Mantieni il core contratto per stabilizzare il busto. Non inarcare la schiena durante la spinta.",
            "Alzate laterali": "Usa pesi moderati per controllare il movimento. Mantieni i gomiti leggermente flessi e solleva fino all'altezza delle spalle. Non usare slancio.",
            "Alzate frontali": "Non sollevare oltre le spalle. Alterna tra manubri, bilanciere e cavi per variare lo stimolo. Mantieni il controllo durante tutto il movimento.",
            "Shoulder press": "Mantieni la schiena dritta. Puoi eseguire sia in piedi che seduto. Se in piedi, contrai i glutei per stabilizzare il bacino.",
            "Alzate a 90°": "Movimento lento e controllato. Solleva i manubri fino all'altezza delle spalle con i gomiti a 90°. Mantieni le spalle basse durante l'esecuzione.",
            "Curl con bilanciere": "Evita di dondolare il corpo. Mantieni i gomiti vicini ai fianchi. Controlla la fase negativa per massimizzare i risultati.",
            "Curl alternato con manubri": "Concentrati sulla contrazione. Ruota leggermente i polsi nella fase finale del movimento. Alterna tra presa supina e hammer per variare lo stimolo.",
            "French press": "Stai attento alla posizione dei gomiti. Mantienili stretti e puntati verso l'alto. Esegui sia con bilanciere che con manubri per variare.",
            "Push down": "Non alzare troppo i gomiti. Mantienili vicini al corpo. Usa diverse attrezzature (corda, barra dritta, barra a V) per variare lo stimolo.",
            "Hammer curl": "Controlla la fase di discesa. Mantieni i palmi delle mani rivolti l'uno verso l'altro durante tutto il movimento. Esegui sia in piedi che seduto.",
            "Crunch": "Non forzare il collo. Mantieni le mani dietro la testa senza tirare. Solleva solo le spalle dal pavimento, concentrandoti sulla contrazione degli addominali.",
            "Plank": "Tieni il corpo allineato. Contrai gli addominali e i glutei. Inizia con serie da 20-30 secondi e aumenta gradualmente la durata.",
            "Russian twist": "Non usare troppo slancio. Ruota il busto mantenendo i piedi sollevati per aumentare l'intensità. Puoi usare un peso per aumentare la difficoltà.",
            "Sit-up": "Mantieni i piedi a terra. Controlla il movimento in tutte le fasi. Per ridurre lo stress sulla schiena, esegui su una superficie leggermente inclinata.",
            "Leg raise": "Evita di inarcare la schiena. Mantieni le gambe dritte o leggermente flesse. Per ridurre la difficoltà, esegui con le ginocchia piegate.",
            "Croci ai cavi alti": "Mantieni i gomiti leggermente flessi e stabili. Esegui un movimento a semicerchio dal basso verso l'alto. Contrai il petto nella fase finale del movimento.",
            "Croci ai cavi bassi": "Esegui un movimento diagonale dal basso verso l'alto. Mantieni una leggera flessione dei gomiti durante tutto il movimento. Contrai i pettorali nella fase di massima contrazione.",
            "Croci con manubri su panca piana": "Mantieni i gomiti leggermente flessi e fermi. Non abbassare troppo i manubri per evitare stress alle spalle. Controlla la fase negativa del movimento.",
            "Spinte con manubri su panca inclinata": "Controlla il movimento, evitando di estendere completamente i gomiti. Mantieni la schiena aderente alla panca. La panca dovrebbe essere inclinata a 30-45 gradi.",
            "Spinte con manubri su panca piana": "Assicurati che i polsi siano allineati con i gomiti. Non bloccare i gomiti nella fase di spinta. Mantieni i piedi ben piantati a terra per stabilità.",
            "Low row": "Mantieni la schiena dritta e tira con i gomiti. Evita di usare lo slancio. Contrai le scapole nella fase finale del movimento.",
            "Lat machine presa inversa": "Utilizza una presa supina per enfatizzare il lavoro sui bicipiti. Mantieni il busto leggermente inclinato all'indietro. Tira la barra verso il petto, non verso il collo.",
            "Lat machine presa neutra": "Concentrati sul movimento dei gomiti verso il basso. Mantieni le spalle basse durante tutto il movimento. Esegui con controllo, senza slancio.",
            "Triangolo alla lat machine": "Mantieni il busto leggermente inclinato all'indietro. Usa una presa stretta con i palmi delle mani rivolti l'uno verso l'altro. Tira il triangolo verso il petto.",
            "Pulley presa larga": "Evita di oscillare il corpo. Mantieni le spalle basse durante tutto il movimento. Tira la barra verso il petto, non verso l'addome.",
            "Adductor machine": "Esegui il movimento lentamente. Non usare troppo peso per evitare stress all'articolazione dell'anca. Contrai gli adduttori nella fase finale del movimento.",
            "Abductor machine": "Mantieni la schiena appoggiata allo schienale. Non usare slancio. Concentrati sulla contrazione dei glutei durante il movimento.",
            "Stacchi rumeni": "Mantieni le gambe leggermente flesse e la schiena dritta. Abbassa il bilanciere lungo le gambe, mantenendolo vicino al corpo. Non arrotondare la schiena.",
            "Hiptrust": "Spingi attraverso i talloni e contrai i glutei. Mantieni il mento leggermente rientrato per evitare di inarcare la schiena. Usa uno step o una panca per aumentare il range di movimento.",
            "Gluteos machine": "Controlla il movimento, evitando slanci. Mantieni il busto eretto durante l'esecuzione. Contrai i glutei nella fase finale del movimento.",
            "Calf seduto": "Esegui il movimento lentamente. Massimizza il range di movimento, scendendo il più possibile e sollevando fino alla massima contrazione. Puoi eseguire sia con bilanciere che con manubri.",
            "Calf in piedi": "Mantieni le ginocchia leggermente flesse. Esegui sia con bilanciere che alla macchina specifica. Per aumentare l'intensità, esegui su un gradino per aumentare il range di movimento.",
            "Hack squat": "Mantieni la schiena appoggiata allo schienale. Non bloccare le ginocchia in estensione. Scendi fino a quando le cosce sono parallele alla pedana.",
            "Alzate oblique al cavo": "Esegui il movimento lentamente. Mantieni il core contratto per stabilizzare il busto. Ruota il busto mantenendo i fianchi fermi.",
            "Bicipite machine": "Assicurati che i gomiti rimangano fermi. Controlla la fase negativa del movimento. Non usare troppo peso per evitare di compensare con le spalle.",
            "Push down con corda": "Mantieni i gomiti vicini al corpo. Alla fine del movimento, separa le due estremità della corda per enfatizzare la contrazione dei tricipiti. Non usare slancio.",
            "Spider curl su panca a 30/45": "Mantieni il petto appoggiato alla panca. Controlla la fase negativa del movimento. Esegui con manubri o bilanciere EZ.",
            "Leg curl": "Mantieni il bacino aderente alla panca durante l'esecuzione. Non sollevare i glutei durante il movimento. Controlla la fase negativa per massimizzare i risultati.",
            "Good morning": "Mantieni la schiena dritta e piegati solo a livello delle anche. Esegui con un bilanciere leggero per evitare infortuni. Non arrotondare la schiena durante il movimento.",
            "Face pull": "Tira la corda verso la fronte mantenendo i gomiti alti. Contrai le scapole nella fase finale del movimento. Esegui con controllo, senza slancio.",
            "Arnold Press": "Ruota i manubri durante il movimento per un lavoro completo. Mantieni il core contratto per stabilizzare il busto. Non inarcare la schiena durante la spinta.",
            "Spinte Frontali su panca a 90": "Mantieni la schiena ben aderente alla panca. Esegui con manubri o bilanciere. Non bloccare i gomiti nella fase di spinta."
        };

        function generaScheda() {
            // Validazione input
            const nomeUtente = document.getElementById("nome").value.trim();
            const cognomeUtente = document.getElementById("cognome").value.trim();
            if (!nomeUtente || !cognomeUtente) {
                alert("Inserisci nome e cognome");
                return;
            }

            const obiettivo = document.getElementById('obiettivo').value;
            const eta = parseInt(document.getElementById("eta").value) || 30;
            const tipologia = document.getElementById('tipologia').value;
            const giorni = parseInt(document.getElementById("giorni").value);
            const peso = parseFloat(document.getElementById("peso").value);
            const altezza = parseFloat(document.getElementById("altezza").value);
            
            // Gruppi muscolari selezionati in base alla tipologia
            const gruppiSelezionati = getGruppiByTipologia(tipologia);
            if (gruppiSelezionati.length === 0) return; // Per cardio
            
            // Distribuzione dei gruppi muscolari per giorno
            const gruppiPerSettimana = distribuisciGruppi(gruppiSelezionati, giorni, tipologia);

            let output = `<h2 class="success"><i class="fas fa-check-circle"></i> Scheda di allenamento per ${nomeUtente} ${cognomeUtente}</h2>`;
            
            // Aggiungi sezione BMI all'inizio se disponibili peso e altezza
            if (peso && altezza) {
                output += calcolaBMISection(peso, altezza);
            }
            
            // Aggiungi stretching post-allenamento subito dopo il BMI
            output += `
                <div class="warmup-stretching">
                    <h2><i class="fas fa-spa"></i> Stretching Post-Allenamento</h2>
                    <p class="info"><i class="fas fa-clock"></i> Dedica 10-15 minuti allo stretching dopo ogni sessione per migliorare il recupero e la flessibilità</p>
                    
                    <div class="stretching-grid">
                        <div class="stretching-card">
                            <h4><i class="fas fa-arrows-alt-v"></i> Stretching Inferiore</h4>
                            <ul>
                                <li><strong>Quadricipiti:</strong> 30-45 sec per gamba. Afferra la caviglia e avvicina il tallone al gluteo, mantenendo le ginocchia vicine</li>
                                <li><strong>Femorali:</strong> 30-45 sec per gamba. Seduto a terra, allunga una gamba e cerca di toccare la punta del piede mantenendo la schiena dritta</li>
                                <li><strong>Polpacci:</strong> 30 sec per gamba. Appoggia le mani al muro e porta indietro una gamba, mantenendola tesa e con il tallone a terra</li>
                                <li><strong>Fianchi:</strong> 30 sec per lato. Posizione del piccione o farfalla per aprire i fianchi</li>
                            </ul>
                            <div class="execution-tips">
                                <p><i class="fas fa-lightbulb"></i> <strong>Suggerimenti:</strong> Mantieni ogni posizione senza molleggiare, respirando profondamente. Non forzare mai il movimento oltre il tuo range di comfort.</p>
                            </div>
                        </div>
                        
                        <div class="stretching-card">
                            <h4><i class="fas fa-arrows-alt"></i> Stretching Superiore</h4>
                            <ul>
                                <li><strong>Pettorali:</strong> 30-45 sec per lato. Appoggia l'avambraccio al muro e ruota il busto per aprire il petto</li>
                                <li><strong>Spalle:</strong> 30 sec per direzione. Porta un braccio davanti al petto e spingi delicatamente con l'altra mano</li>
                                <li><strong>Tricipiti:</strong> 30 sec per braccio. Porta il braccio dietro la testa e spingi delicatamente il gomito con l'altra mano</li>
                                <li><strong>Schiena:</strong> 45 sec torsione. Seduto a terra con una gamba incrociata, ruota il busto verso la gamba piegata</li>
                            </ul>
                            <div class="execution-tips">
                                <p><i class="fas fa-lightbulb"></i> <strong>Suggerimenti:</strong> Esegui movimenti lenti e controllati, senza forzare. Se senti dolore, riduci l'intensità dello stretch.</p>
                            </div>
                        </div>
                        
                        <div class="stretching-card">
                            <h4><i class="fas fa-procedures"></i> Stretching Avanzato</h4>
                            <ul>
                                <li><strong>Stretching dinamico:</strong> Oscillazioni controllate delle gambe avanti-indietro e laterali per migliorare la mobilità</li>
                                <li><strong>PNF:</strong> Contrazione-rilassamento. Contrai il muscolo per 5-10 sec, poi rilascia e approfondisci lo stretch</li>
                                <li><strong>Yoga flow:</strong> Sequenza di 5 minuti che combina posizioni per allungare tutto il corpo</li>
                                <li><strong>Respirazione:</strong> 2 minuti diaframmatica per rilassare la muscolatura e migliorare l'ossigenazione</li>
                            </ul>
                            <div class="execution-tips">
                                <p><i class="fas fa-lightbulb"></i> <strong>Suggerimenti:</strong> Per atleti avanzati: aumenta gradualmente intensità e durata. Lo stretching dinamico è particolarmente utile prima dell'allenamento, mentre quello statico dopo.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="highlight-box">
                        <p><i class="fas fa-heartbeat"></i> <strong>Benefici dello stretching:</strong> Migliora la flessibilità, riduce il rischio di infortuni, allevia le tensioni muscolari e favorisce il recupero. Aiuta a mantenere una buona postura e aumenta la consapevolezza corporea.</p>
                    </div>
                </div>
            `;
            
            for (let settimana = 1; settimana <= 6; settimana++) {
                output += generaSettimana(settimana, eta, tipologia, giorni, gruppiPerSettimana, obiettivo);
            }

            document.getElementById("scheda").innerHTML = output;
        }

        function calcolaBMISection(peso, altezza) {
            // Calcola il BMI: peso (kg) / (altezza (m) ^ 2)
            const altezzaInMetri = altezza / 100;
            const bmi = peso / (altezzaInMetri * altezzaInMetri);
            const bmiArrotondato = bmi.toFixed(1);
            
            // Determina la categoria
            let categoria, classe, consiglio;
            if (bmi < 18.5) {
                categoria = "Sottopeso";
                classe = "underweight";
                consiglio = "Potresti beneficiare di un programma di allenamento focalizzato sull'aumento di massa muscolare e di un piano nutrizionale ipercalorico.";
            } else if (bmi < 25) {
                categoria = "Normale";
                classe = "normal";
                consiglio = "Il tuo peso è nella norma. Mantieni uno stile di vita attivo e un'alimentazione equilibrata per preservare la tua salute.";
            } else if (bmi < 30) {
                categoria = "Sovrappeso";
                classe = "overweight";
                consiglio = "Potresti beneficiare di un programma di allenamento che combina esercizi cardiovascolari e di resistenza, insieme a un piano nutrizionale bilanciato.";
            } else {
                categoria = "Obeso";
                classe = "obese";
                consiglio = "Ti consigliamo di consultare un professionista della salute per un programma personalizzato che combini attività fisica e alimentazione controllata.";
            }
            
            return `
                <div class="bmi-section">
                    <div class="bmi-title">
                        <i class="fas fa-heartbeat"></i> Il tuo Indice di Massa Corporea (BMI)
                    </div>
                    <div class="bmi-value">${bmiArrotondato}</div>
                    <div class="bmi-category ${classe}">${categoria}</div>
                    <div class="bmi-info">
                        <p><strong>BMI (Body Mass Index)</strong> è un indicatore del rapporto tra peso e altezza che fornisce una stima della composizione corporea.</p>
                        <p><strong>Consiglio:</strong> ${consiglio}</p>
                        <ul>
                            <li><strong>Sottopeso:</strong> BMI inferiore a 18.5</li>
                            <li><strong>Normale:</strong> BMI tra 18.5 e 24.9</li>
                            <li><strong>Sovrappeso:</strong> BMI tra 25 e 29.9</li>
                            <li><strong>Obesità:</strong> BMI 30 o superiore</li>
                        </ul>
                        <p class="info"><i class="fas fa-info-circle"></i> Il BMI è solo un indicatore generale e non tiene conto della composizione corporea (muscoli vs grasso). Consulta sempre un professionista per una valutazione completa.</p>
                    </div>
                </div>
            `;
        }

        function getGruppiByTipologia(tipologia) {
            const gruppi = Object.keys(esercizi);
            switch(tipologia) {
                case "classica": return [...gruppi];
                case "totalbody": return [...gruppi];
                case "over60": return ["gambe", "spalle", "core"];
                case "gambe": return ["gambe"];
                case "cardio": 
                    document.getElementById("scheda").innerHTML = `
                        <h2><i class="fas fa-heartbeat"></i> Programma Cardio</h2>
                        <div class="highlight-box">
                            <p><strong>Obiettivo:</strong> Migliorare la resistenza cardiovascolare</p>
                        </div>
                        <ul>
                            <li><i class="fas fa-running"></i> 20 min camminata veloce</li>
                            <li><i class="fas fa-jump-rope"></i> 10 min salti con la corda</li>
                            <li><i class="fas fa-bicycle"></i> 20 min cyclette</li>
                            <li><i class="fas fa-spa"></i> Stretching finale</li>
                        </ul>
                        <p class="warning"><i class="fas fa-info-circle"></i> Ripetere 3-4 volte a settimana</p>
                    `;
                    return [];
                default: return [...gruppi];
            }
        }

        function distribuisciGruppi(gruppiSelezionati, giorni, tipologia) {
            const gruppiPerSettimana = [];
            if (tipologia === "totalbody") {
                // Mescola i gruppi per varietà
                const shuffled = [...gruppiSelezionati].sort(() => 0.5 - Math.random());
                for (let i = 0; i < giorni; i++) {
                    const start = (i * 3) % gruppiSelezionati.length;
                    let gruppoGiorno = shuffled.slice(start, start + 3);
                    if (gruppoGiorno.length < 3) {
                        grupoGiorno = grupoGiorno.concat(shuffled.slice(0, 3 - grupoGiorno.length));
                    }
                    gruppiPerSettimana.push(gruppoGiorno);
                }
            } else {
                // Distribuzione ciclica dei gruppi
                for (let i = 0; i < giorni; i++) {
                    gruppiPerSettimana.push([gruppiSelezionati[i % gruppiSelezionati.length]]);
                }
            }
            return gruppiPerSettimana;
        }

        function generaSettimana(settimana, eta, tipologia, giorni, gruppiPerSettimana, obiettivo) {
            let output = `<div class="week-title"><i class="fas fa-calendar-week"></i> Settimana ${settimana}</div>`;
            if (eta >= 50 || tipologia === "over60") {
                output += `<p class="warning"><i class="fas fa-info-circle"></i> Scheda adattata per età superiore ai 50 anni</p>`;
            }

            for (let i = 0; i < giorni; i++) {
                output += generaGiornoAllenamento(i+1, gruppiPerSettimana[i], tipologia, obiettivo, eta);
            }
            return output;
        }

        function generaGiornoAllenamento(giorno, gruppiGiorno, tipologia, obiettivo, eta) {
            const nomeGruppo = gruppiGiorno.map(g => g.charAt(0).toUpperCase() + g.slice(1)).join(" / ");
            const numEsercizi = tipologia === "totalbody" ? 6 : 5 + Math.floor(Math.random() * 3);
            
            let eserciziGiorno = [];
            
            if (gruppiGiorno.includes("gambe")) {
                // Filtra solo gli esercizi esistenti nella lista
                const eserciziGambeDisponibili = [...esercizi.gambe];
                const eserciziQuadDisponibili = ["Squat", "Leg press", "Leg extension", "Hack squat"]
                    .filter(ex => esercizi.gambe.includes(ex));
                const eserciziFemoraliDisponibili = ["Stacchi da terra", "Stacchi rumeni", "Leg curl", "Good morning"]
                    .filter(ex => esercizi.gambe.includes(ex));

                // Seleziona 2 quadricipiti (se disponibili)
                const quadExercises = [];
                const tempQuad = [...eserciziQuadDisponibili];
                for (let i = 0; i < Math.min(2, tempQuad.length); i++) {
                    const randomIndex = Math.floor(Math.random() * tempQuad.length);
                    quadExercises.push(tempQuad[randomIndex]);
                    tempQuad.splice(randomIndex, 1);
                }

                // Seleziona 2 femorali (se disponibili)
                const femoraliExercises = [];
                const tempFemorali = [...eserciziFemoraliDisponibili];
                for (let i = 0; i < Math.min(2, tempFemorali.length); i++) {
                    const randomIndex = Math.floor(Math.random() * tempFemorali.length);
                    femoraliExercises.push(tempFemorali[randomIndex]);
                    tempFemorali.splice(randomIndex, 1);
                }

                // Combina e completa con altri esercizi
                const eserciziObbligatori = [...quadExercises, ...femoraliExercises];
                const altriEsercizi = eserciziGambeDisponibili
                    .filter(ex => !eserciziObbligatori.includes(ex))
                    .sort(() => 0.5 - Math.random())
                    .slice(0, numEsercizi - eserciziObbligatori.length);

                eserciziGiorno = [...eserciziObbligatori, ...altriEsercizi];
                
                // Se non raggiungiamo il minimo, aggiungiamo altri esercizi disponibili
                if (eserciziGiorno.length < 5) {
                    const extra = eserciziGambeDisponibili
                        .filter(ex => !eserciziGiorno.includes(ex))
                        .slice(0, 5 - eserciziGiorno.length);
                    eserciziGiorno = [...eserciziGiorno, ...extra];
                }
            } else {
                // Per altri gruppi muscolari
                eserciziGiorno = gruppiGiorno
                    .flatMap(gr => [...esercizi[gr]])
                    .sort(() => 0.5 - Math.random())
                    .slice(0, numEsercizi);
            }

            let output = `<div class="day-title"><i class="fas fa-dumbbell"></i> Giorno ${giorno} - ${nomeGruppo}</div>
                <div class="highlight-box">
                    <p><strong>Obiettivo:</strong> ${getObiettivoText(obiettivo)}</p>
                    <p><strong>Durata stimata:</strong> ${getDurataStimata(eserciziGiorno.length)} minuti</p>
                    ${gruppiGiorno.includes("gambe") ? '<p><i class="fas fa-info-circle"></i> <strong>Focus:</strong> Bilanciamento tra quadricipiti e femorali</p>' : ''}
                    <p><i class="fas fa-lightbulb"></i> <strong>Suggerimento:</strong> ${getConsiglioGiorno(gruppiGiorno, obiettivo)}</p>
                </div>
                <table>
                    <tr>
                        <th>Esercizio</th>
                        <th>Serie</th>
                        <th>Ripetizioni</th>
                        <th>Intensità</th>
                        <th>Recupero</th>
                        <th>Suggerimento</th>
                    </tr>`;

            for (let es of eserciziGiorno) {
                const { serie, rip, intensita, recupero } = getParametriEsercizio(obiettivo, eta, tipologia);
                const tip = suggerimenti[es] || "";
                output += `<tr>
                    <td><i class="fas fa-dumbbell exercise-icon"></i>${es}</td>
                    <td>${serie}</td>
                    <td>${rip}</td>
                    <td>${intensita}</td>
                    <td>${recupero}</td>
                    <td style='color:#666;font-size:0.9em;'>${tip}</td>
                </tr>`;
            }
            output += "</table>";
            return output;
        }

        function getConsiglioGiorno(gruppiGiorno, obiettivo) {
            if (gruppiGiorno.includes("gambe")) {
                return obiettivo === "massa" ? 
                    "Per la crescita muscolare, concentrati su esercizi composti come squat e stacchi con carichi pesanti e recupero adeguato." : 
                    "Per la definizione, includi più ripetizioni con carichi moderati e recuperi brevi tra le serie.";
            } else if (gruppiGiorno.includes("petto") || gruppiGiorno.includes("schiena")) {
                return "Mantieni una buona forma durante tutti gli esercizi. Per i principianti, inizia con carichi leggeri per padroneggiare la tecnica.";
            } else if (gruppiGiorno.includes("spalle")) {
                return "Fai attenzione alla tecnica negli esercizi per le spalle per evitare infortuni. Non usare carichi eccessivi.";
            }
            return "Mantieni il controllo durante tutti gli esercizi e concentrati sulla contrazione muscolare.";
        }

        function getObiettivoText(obiettivo) {
            const obiettivi = {
                "massa": "Aumento massa muscolare",
                "definizione": "Definizione muscolare",
                "forza": "Aumento forza",
                "dimagrimento": "Dimagrimento",
                "cardio": "Miglioramento capacità cardiovascolare"
            };
            return obiettivi[obiettivo] || "Allenamento generico";
        }

        function getDurataStimata(numEsercizi) {
            return numEsercizi * 10 + 10; // 10 min per esercizio + 10 min riscaldamento/stretching
        }

        function getParametriEsercizio(obiettivo, eta, tipologia) {
            let rip, serie, intensita, recupero;
            
            if (obiettivo === "massa") {
                rip = "8-10";
                serie = "3-4";
            } else if (obiettivo === "definizione") {
                rip = "12-15";
                serie = "3";
            } else { // forza o default
                rip = "5-7";
                serie = "4-5";
            }

            if (eta >= 50 || tipologia === "over60") {
                intensita = obiettivo === "massa" ? "60-70%" : obiettivo === "definizione" ? "50-60%" : "70-80%";
                recupero = obiettivo === "massa" ? "90-120 sec" : obiettivo === "definizione" ? "60-90 sec" : "120-150 sec";
            } else {
                intensita = obiettivo === "massa" ? "75-85%" : obiettivo === "definizione" ? "60-70%" : "85-95%";
                recupero = obiettivo === "massa" ? "60-90 sec" : obiettivo === "definizione" ? "30-60 sec" : "90-120 sec";
            }

            return { serie, rip, intensita, recupero };
        }

        function scaricaPDF() {
            const element = document.getElementById("scheda");
            if (element.innerHTML.trim() === "") {
                alert("Genera prima una scheda di allenamento");
                return;
            }
            const opt = {
                margin: 10,
                filename: 'scheda_allenamento.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save();
        }
    </script>
</body>
</html>